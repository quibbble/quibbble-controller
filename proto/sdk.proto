syntax = "proto3";

package quibbble.com;
option go_package = "/quibbble";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "game.proto";

// gRPC definition for the SDK Server.
// This service sits in front of the Game Server and 
// handles all player connections and networking.
// Wrappers are created around the SDK client to
// provide users with an SDK for interacting with Quibbble APIs.
service SDK {
    // Retrieves the current state of the game from the player's viewpoint.
    rpc GetSnapshot(Player) returns (SDKSnapshot) {}

    // Streams all updates to the game from the player's viewpoint.
    rpc StreamSnapshot(Player) returns (stream SDKSnapshot) {}

    // Allows a player to join a team.
    rpc JoinTeam(Player) returns (google.protobuf.Empty) {}

    // Allows a player to play an action.
    rpc PlayAction(SDKAction) returns (google.protobuf.Empty) {}

    // Allows a player to undo the last action if they were the ones to play the action.
    rpc UndoAction(Player) returns (google.protobuf.Empty) {}

    // Allows a player to reset the entire game.
    rpc ResetGame(Player) returns (google.protobuf.Empty) {}
}

// Player is someone playing the game.
message Player {
    // The unique id of the player.
    string id = 1;

    // The display name of the player.
    string name = 2;

    // The team the player is on.
    string team = 3;

    // Whether or not the player is currently connected.
    bool online = 4;
}

// SDKSnapshot is a snapshot of the SDK server.
message SDKSnapshot {
    // When the game was created.
    google.protobuf.Timestamp created_at = 1;

    // List of all players that have ever joined the game.
    repeated Player players = 2;

    // The current game snapshot.
    GameSnapshot snapshot = 3;

    // The list of all past actions done on the game.
    repeated SDKAction history = 4;
}

// SDKAction is an action done by a player.
message SDKAction {
    // The player doing the action.
    Player player = 1;

    // The action being done on the game.
    GameAction action = 2;
}
